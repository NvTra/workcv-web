<!DOCTYPE html>
<html lang="en">

<head>
	<title>Work CV</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700&display=swap" rel="stylesheet">

	<!-- CSS -->
	<link rel="stylesheet" th:href="@{/resources/assets/css/open-iconic-bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/animate.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/owl.carousel.min.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/owl.theme.default.min.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/magnific-popup.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/owl.carousel.min.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/owl.theme.default.min.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/aos.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/ionicons.min.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/bootstrap-datepicker.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/jquery.timepicker.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/css/bootstrap-reboot.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/css/mixins/_text-hide.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/flaticon.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/icomoon.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/style.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/bootstrap/bootstrap-grid.css}">
	<link rel="stylesheet" th:href="@{/resources/assets/css/bootstrap/bootstrap-reboot.css}">

	<!-- JS -->
	<script th:src="@{/resources/assets/js/jquery.min.js}"></script>
	<script th:src="@{/resources/assets/js/jquery-migrate-3.0.1.min.js}"></script>
	<script th:src="@{/resources/assets/js/popper.min.js}"></script>
	<script th:src="@{/resources/assets/js/bootstrap.min.js}"></script>
	<script th:src="@{/resources/assets/js/jquery.easing.1.3.js}"></script>
	<script th:src="@{/resources/assets/js/jquery.waypoints.min.js}"></script>
	<script th:src="@{/resources/assets/js/jquery.stellar.min.js}"></script>
	<script th:src="@{/resources/assets/js/owl.carousel.min.js}"></script>
	<script th:src="@{/resources/assets/js/jquery.magnific-popup.min.js}"></script>
	<script th:src="@{/resources/assets/js/aos.js}"></script>
	<script th:src="@{/resources/assets/js/jquery.animateNumber.min.js}"></script>
	<script th:src="@{/resources/assets/js/scrollax.min.js}"></script>
	<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
	<script th:src="@{/resources/assets/js/google-map.js}"></script>
	<script th:src="@{/resources/assets/js/main.js}"></script>
	<script src="https://cdn.ckeditor.com/ckeditor5/29.0.0/classic/ckeditor.js"></script>
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>
	<!--NAV-->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid px-md-4">
			<a class="navbar-brand" th:href="@{/}">Work CV</a>
			<div class="collapse navbar-collapse" id="ftco-nav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item active">
						<a th:href="@{/}" class="nav-link">Trang chủ</a>
					</li>
					<!-- EMPLOYER -->
					<li sec:authorize="hasRole('EMPLOYER')" class="nav-item">
						<a th:href="@{/recruitment/list-post}" class="nav-link">Công việc</a>
					</li>

					<li sec:authorize="hasRole('EMPLOYER')" class="nav-item">
						<a th:href="@{/}" class="nav-link">Ứng cử viên</a>
					</li>

					<li sec:authorize="hasRole('EMPLOYER')" th:if="${not #strings.isEmpty(#request.remoteUser)}"
						class="nav-item dropdown">
						<a style="color: white" class="nav-link" href="#" id="navbarDropdownMenuLink" role="button"
							data-toggle="dropdown" aria-expanded="false">Đăng tuyển</a>
						<ul style="left: -85px !important" class="dropdown-menu"
							aria-labelledby="navbarDropdownMenuLink">
							<li>
								<a class="dropdown-item" th:href="@{/detail}">Hồ Sơ</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/recruitment/list-post}">Danh sách bài đăng</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/recruitment/post}">Đăng Tuyển</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/logout}">Đăng xuất</a>
							</li>
						</ul>
					</li>

					<!--CADIDATE-->
					<li sec:authorize="hasRole('CANDIDATE')" class="nav-item">
						<a th:href="@{/}" class="nav-link">Công việc</a>
					</li>
					<li sec:authorize="hasRole('CANDIDATE')" th:if="${not #strings.isEmpty(#request.remoteUser)}"
						class="nav-item dropdown">
						<a style="color: white" class="nav-link" href="#" id="navbarDropdownMenuLink" role="button"
							data-toggle="dropdown" aria-expanded="false">Hồ sơ</a>
						<ul style="left: -85px !important" class="dropdown-menu"
							aria-labelledby="navbarDropdownMenuLink">
							<li>
								<a class="dropdown-item" th:href="@{/detail}">Hồ Sơ</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/save-job/get-list}">Công việc đã lưu</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/user/get-list-apply}">Công việc đã ứng tuyển</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/user/get-list-company}">Công ty đã theo dõi</a>
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/logout}">Đăng xuất</a>
							</li>
						</ul>
					</li>
					<!--LOGIN && REGISTER-->
					<div th:if="${#strings.isEmpty(#request.remoteUser)}">
						<li class="nav-item cta cta-colored">
							<a th:href="@{/auth/login}" class="nav-link">Đăng nhập</a>
						</li>
					</div>
				</ul>
			</div>
		</div>
	</nav>
	<!-- END nav -->
	<div th:if="${success}" class="toast" data-delay="2000"
		style="position:fixed;top: 100PX; right: 10PX;z-index: 2000;width: 300px">
		<script>
			swal({
				title: 'Ứng cử viên này chưa cập nhật cv!',
				/* text: 'Redirecting...', */
				icon: 'error',
				timer: 3000,
				buttons: true,
				type: 'error'
			})
		</script>
	</div>
	<!-- END nav -->
	<div class="hero-wrap hero-wrap-2" th:style="'background-image: url('+@{/resources/assets/images/bg_1.jpg}+')'"
		data-stellar-background-ratio="0.5">
		<div class="overlay"></div>
		<div class="container">
			<div class="row no-gutters slider-text align-items-end justify-content-start">
				<div class="col-md-12 text-center mb-5">
					<p class="breadcrumbs mb-0"><span class="mr-3"><a th:href="@{/}">Trang chủ <i
									class="ion-ios-arrow-forward"></i></a></span>Công việc <span></span></p>
					<h1 class="mb-3 bread">Danh sách ứng cử viên</h1>
				</div>
			</div>
		</div>
	</div>
	<section class="ftco-section bg-light">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 pr-lg-5">
					<div class="row">
						<th:block th:each="applyPost : ${list}">
							<div class="col-md-12"
								style="box-shadow: rgba(0, 0, 0, 0.4) 0px 0px 10px;margin: 20px auto;">
								<div class="team d-md-flex p-4 bg-white">
									<IMG style="margin-top: 10px" class="img"
										th:src="${applyPost.user.image != null ? applyPost.user.image : 'https://st.quantrimang.com/photos/image/072015/22/avatar.jpg'}"></IMG>
									<div class="text pl-md-4">
										<H5 class="location mb-0" th:text="${applyPost.user.fullName}"></H5>
										<p style="display: block;color: black" th:text="${applyPost.user.address}"></p>
										<span class="position" style="display: block;color: black"
											th:text="${applyPost.user.email}"></span>
										<p class="mb-4" style="width: 700px" th:utext="${applyPost.user.description}">.
										</p>
										<div th:if="${applyPost.nameCv != null}" style="margin-left: 1px" class="row">
											<p><a th:href="${'/user/getCv/'}+${applyPost.id}"
													class="btn btn-primary">Xem cv</a></p>
										</div>
									</div>
								</div>
							</div>
						</th:block>
						<div style="text-align: center" th:if="${list.size() == 0}">
							<p style="color: red">Chưa có ứng cử viên nào ứng tuyển</p>
						</div>
					</div>
					
					<div th:if="${totalPages > 1}" class="row pagination-wrap">
						<ul class="pagination ml-auto">
							<li class="page-item">
								<a th:if="${currentPage != 1}" class="page-link"
									th:href="@{'?keySearch='+${keySearch}+'&page=' + ${currentPage - 1}}">Trang
									trước</a>
								<a th:if="${currentPage == 1}" class="page-link disabled">Trang trước</a>
							</li>
							<li class="page-item">
								<a th:if="${currentPage != totalPages}" class="page-link"
									th:href="@{'?keySearch='+${keySearch}+'&page=' + ${currentPage + 1}}">Trang kế
									tiếp</a>
								<a th:if="${currentPage == totalPages}" class="page-link disabled">Trang kế tiếp</a>
							</li>
						</ul>
					</div>
				</div>

			</div>
		</div>
	</section>
	<script>
		function save(id) {
			var name = "#idRe" + id;
			var idRe = $(name).val();
			var formData = new FormData();
			formData.append('idRe', idRe);
			$.ajax(
				{
					type: 'POST',
					url: '/save-job/save/',
					contentType: false,
					processData: false,
					data: formData,
					success: function (data) {
						console.log(data);
						if (data == "false") {
							swal({
								title: 'Bạn cần phải đăng nhập!',
								/* text: 'Redirecting...', */
								icon: 'error',
								timer: 3000,
								buttons: true,
								type: 'error'
							})
						} else if (data == "true") {
							swal({
								title: 'Lưu thành công!',
								/* text: 'Redirecting...', */
								icon: 'success',
								timer: 3000,
								buttons: true,
								type: 'success'
							})
						} else {
							swal({
								title: 'Bạn đã lưu bài này rồi!',
								/* text: 'Redirecting...', */
								icon: 'error',
								timer: 3000,
								buttons: true,
								type: 'error'
							})
						}
					},
					error: function (err) {
						alert(err);
					}
				}
			)
		}

		function apply(id) {
			var name = "#idRe" + id;
			var nameModal = "#exampleModal" + id;
			var nameFile = "#fileUpload" + id;
			var nameText = "#text" + id;
			var idRe = $(name).val();
			var textvalue = $(nameText).val();
			var fileUpload = $(nameFile).get(0);
			var files = fileUpload.files;
			var formData = new FormData();
			formData.append('file', files[0]);
			formData.append('idRe', idRe);
			formData.append('text', textvalue);
			if (files[0] == null) {
				swal({
					title: 'Bạn cần phải chọn cv!',
					/* text: 'Redirecting...', */
					icon: 'error',
					timer: 3000,
					buttons: true,
					type: 'error'
				})
			} else {
				$.ajax(
					{
						type: 'POST',
						url: '/user/apply-job/',
						contentType: false,
						processData: false,
						data: formData,
						success: function (data) {
							if (data == "false") {
								swal({
									title: 'Bạn cần phải đăng nhập!',
									/* text: 'Redirecting...', */
									icon: 'error',
									timer: 3000,
									buttons: true,
									type: 'error'
								})
							} else if (data == "true") {
								swal({
									title: 'Ứng tuyển thành công!',
									/* text: 'Redirecting...', */
									icon: 'success',
									timer: 3000,
									buttons: true,
									type: 'success'
								})
								$(nameModal).modal('hide');
								$('#fileUpload').val("");
							} else {
								swal({
									title: 'Bạn đã ứng tuyển công việc này!',
									/* text: 'Redirecting...', */
									icon: 'error',
									timer: 3000,
									buttons: true,
									type: 'error'
								})
								$(nameModal).modal('hide');
								$('#fileUpload').val("");
							}
						},
						error: function (err) {
							alert(err);
						}
					}
				)
			}

		}
	</script>



</body>

</html>